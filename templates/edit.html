{% extends "layout.html" %}

{% block title %}
Edit
{% endblock %}

{% block main %}
<div class="container m-5" id="div1">
    <div class="row">
        <div class="col-sm-6">
            <h1>Title</h1>
            <textarea class="form-control mb-5" rows="3" id="edit-desc"></textarea>
        </div>
        <div class="col-sm-6">
            <div class="d-flex justify-content-end">
                <button class="btn btn-light save">Save</button>
            </div>
        </div>
    </div>
    <button class=" form-control btn btn-light mb-5 p-4" id="add">+ add</button>
    <button class="btn btn-light save">Save</button>
</div>

<script>
    document.body.onload = addElements;
    let set = JSON.parse(localStorage.getItem('set'))
    let quantity = set.quantity
    let count = 0
    document.getElementById("add").addEventListener("click", newTerm)
    let save_buttons = document.getElementsByClassName("save")
    let delete_buttons = document.getElementsByClassName("delete")

    for (let i = 0; i < save_buttons.length; i++) {
        save_buttons[i].addEventListener("click", update)
    }

    for (let i = 0; i < delete_buttons.length; i++) {
        delete_buttons[i].addEventListener("click", deleteTerm)
    }

    function addElements() {
        let description = document.getElementById('edit-desc')
        description.value = set.description

        for (let i = 0; i < quantity; i++) {
            let q = set.questions[i].question
            let a = set.questions[i].answer
            createTerm(q, a)
        }
    }

    function newTerm(e) {
        e.preventDefault()

        createTerm('', '')
        quantity++
    }

    function createTerm(q, a) {
        const newTerm = document.createElement("div")
        newTerm.classList.add('card', 'mb-5')

        const termHead = document.createElement("div")
        termHead.classList.add('card-head', 'bg-body-secondary')

        const headDiv = document.createElement("div")
        headDiv.classList.add('d-flex', 'justify-content-between', 'px-5', 'py-1')

        count++
        let index = count - 1

        headDiv.append(document.createElement("p").innerHTML = count.toString())
        const delete_button = document.createElement("button")
        delete_button.classList.add('btn', 'background-body', 'delete')
        delete_button.id = 'delete' + index
        delete_button.innerHTML = 'delete'
        headDiv.append(delete_button)
        termHead.append(headDiv)
        newTerm.append(termHead)

        const termBody = document.createElement("div")
        termBody.classList.add('card-body')

        const bodyRow = document.createElement("div")
        bodyRow.classList.add('row')

        const qCol = document.createElement('div')
        qCol.classList.add('col-sm-6')
        const aCol = document.createElement('div')
        aCol.classList.add('col-sm-6')

        const newQ = document.createElement("textarea")
        newQ.classList.add('form-control')
        newQ.id = "q" + index
        newQ.value = q


        const newA = document.createElement("textarea")
        newA.classList.add('form-control')
        newA.id = "a" + index
        newA.value = a

        qCol.append(newQ)
        aCol.append(newA)
        bodyRow.append(qCol)
        bodyRow.append(aCol)
        termBody.append(bodyRow)
        newTerm.append(termBody)

        let button = document.getElementById('add')
        document.getElementById('div1').insertBefore(newTerm, button)
    }

    function deleteTerm(e) {
        e.preventDefault()

        // remove card
        // update following cards numbers
        // update ids

        // i dont need to actually remove it from the set because cards behind it will just get the new id
        // and then in update it will overwrite the original content
        // if there are less cards than originally thats a problem. because old cards won't get overwritten.
        // if there are more cards how do i make sure they're actually addded to the set..
        // maybe store original quantity and new quantity?
        // if its less we just delete until orig quantity
        // if its more add

        quantity--
    }

    function update(e) {
        e.preventDefault()

        let description = document.getElementById('edit-desc')
        set.description = description.value

        for (let i = 0; i < quantity; i++) {
            set.questions[i].question = document.getElementById('q' + i).value
            set.questions[i].answer = document.getElementById('a' + i).value
        }

        localStorage.setItem('set', JSON.stringify(set))
        localStorage.setItem('quantity', quantity)
        window.location.href = 'terms-preview'
    }

</script>
{% endblock %}